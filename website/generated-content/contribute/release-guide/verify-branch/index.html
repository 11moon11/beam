<!DOCTYPE html>
<!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<html lang="en">
  <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Beam Release Guide: 03 - Verify Branch</title>
  <meta name="description" content="Apache Beam is an open source, unified model and set of language-specific SDKs for defining and executing data processing workflows, and also data ingestion and integration flows, supporting Enterprise Integration Patterns (EIPs) and Domain Specific Languages (DSLs). Dataflow pipelines simplify the mechanics of large-scale batch and streaming data processing and can run on a number of runtimes like Apache Flink, Apache Spark, and Google Cloud Dataflow (a cloud service). Beam also brings DSL in different languages, allowing users to easily implement their data integration processes.
">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400" rel="stylesheet">
  <link rel="stylesheet" href="/css/site.css">
  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/language-switch.js"></script>
  <script src="/js/fix-menu.js"></script>
  <script src="/js/section-nav.js"></script>
  <script src="/js/page-nav.js"></script>
  <link rel="canonical" href="https://beam.apache.org/contribute/release-guide/verify-branch/" data-proofer-ignore>
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="Apache Beam" href="https://beam.apache.org/feed.xml">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-73650088-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

  <body class="body" data-spy="scroll" data-target=".page-nav" data-offset="0">
    <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<nav class="header navbar navbar-fixed-top">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/" class="navbar-brand" >
        <img alt="Brand" style="height: 25px" src="/images/beam_logo_navbar.png">
      </a>
    </div>

    <div class="navbar-mask closed"></div>

    <div id="navbar" class="navbar-container closed">
      <ul class="nav navbar-nav">
        <li>
          <a href="/get-started/beam-overview/">Get Started</a>
        </li>
        <li>
          <a href="/documentation/">Documentation</a>
        </li>
        <li>
          <a href="/documentation/sdks/java/">Languages</a>
        </li>
        <li>
          <a href="/documentation/runners/capability-matrix/">RUNNERS</a>
        </li>
        <li>
          <a href="/roadmap/">Roadmap</a>
        </li>
        <li>
          <a href="/contribute/">Contribute</a>
        </li>
        <li>
          <a href="/community/contact-us/">Community</a>
        </li>
        <li><a href="/blog">Blog</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <div style="width: 300px;">
            <script>
              (function() {
                var cx = '012923275103528129024:4emlchv9wzi';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <gcse:search></gcse:search>
          </div>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="https://www.apache.org/foundation/press/kit/feather_small.png" alt="Apache Logo" style="height:20px;"><span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a href="http://www.apache.org/">ASF Homepage</a></li>
            <li><a href="http://www.apache.org/licenses/">License</a></li>
            <li><a href="http://www.apache.org/security/">Security</a></li>
            <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
            <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
            <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
          </ul>
        </li>
        <li>
          <!--
            data-proofer-ignore disables link checking from website test automation.
            GitHub links will not resolve until the markdown source is available on the master branch.
            New pages would fail validation during development / PR test automation.
          -->
          <a href="https://github.com/apache/beam/edit/master/website/src/contribute/release-guide/3-verify-branch.md" data-proofer-ignore>
            <i class="far fa-edit fa-lg" alt="Edit on GitHub" title="Edit on GitHub"></i>
          </a>
        </li>
      </ul>
    </div>
</nav>

    <div class="clearfix container-main-content">
      <div class="section-nav closed" data-offset-top="90" data-offset-bottom="500">
        <span class="section-nav-back glyphicon glyphicon-menu-left"></span>
        <nav>
          <ul class="section-nav-list" data-section-nav>
            <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<li><span class="section-nav-list-main-title">Contribute</span></li>
<li><a href="/contribute/">Get started contributing</a></li>
<li><a href="/contribute/get-help/">Get Help</a></li>
<li>
  <span class="section-nav-list-title">Technical Docs</span>

  <ul class="section-nav-list">
    <li><a href="https://cwiki.apache.org/confluence/display/BEAM/Contribution+Testing+Guide">Testing guide</a></li>
    <li><a href="/contribute/precommit-triage-guide/">Pre-commit Slowness Triage</a></li>
    <li><a href="/contribute/ptransform-style-guide/">PTransform style guide</a></li>
    <li><a href="/contribute/runner-guide/">Runner authoring guide</a></li>
    <li><a href="/contribute/design-documents/">Design documents</a></li>
    <li><a href="/contribute/dependencies/">Dependencies guide</a></li>
    <li><a href="/contribute/feature-branches/">Feature branches</a></li>
  </ul>
</li>
<li>
  <span class="section-nav-list-title">Policies</span>
  <ul class="section-nav-list">
    <li><a href="/contribute/precommit-policies/">Pre-commit test policies</a></li>
    <li><a href="/contribute/postcommits-policies/">Post-commit test policies</a></li>
  </ul>
</li>
<li>
  <span class="section-nav-list-title">Committers</span>
  <ul class="section-nav-list">
    <li><a href="/contribute/become-a-committer/">Become a committer</a></li>
    <li><a href="/contribute/committer-guide/">Committer guide</a></li>
    <li>
      <span class="section-nav-list-title">Release guide</span>
      <ul class="section-nav-list">

        <li><a href="/contribute/release-guide/">Overview</a></li>
        <li><a href="/contribute/release-guide/prepare/">Prepare</a></li>
        <li><a href="/contribute/release-guide/create-branch/">Create Branch</a></li>
        <li><a href="/contribute/release-guide/verify-branch/">Verify Branch</a></li>
        <li><a href="/contribute/release-guide/build-candidate/">Build Candidate</a></li>
        <li><a href="/contribute/release-guide/triage-jira/">Triage JIRAs</a></li>
        <li><a href="/contribute/release-guide/prepare-docs/">Prepare Docs</a></li>
        <li><a href="/contribute/release-guide/validate-candidate/">Validate Candidate</a></li>
        <li><a href="/contribute/release-guide/finalize/">Finalize</a></li>
        <li><a href="/contribute/release-guide/post-release">Post-release</a></li>
      </ul>
    </li>
  </ul>
</li>

          </ul>
        </nav>
      </div>

      <nav class="page-nav clearfix" data-offset-top="90" data-offset-bottom="500">
        <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->



<ul class="nav">
  <li><a href="#run-verify_release_buildsh">Run <code class="highlighter-rouge">verify_release_build.sh</code></a>
    <ul>
      <li><a href="#verify-the-build-succeeds">Verify the build succeeds</a></li>
    </ul>
  </li>
  <li><a href="#alternative-run-all-commands-manually">(Alternative) Run all commands manually</a></li>
  <li><a href="#create-release-blocking-issues-in-jira">Create release-blocking issues in JIRA</a></li>
  <li><a href="#checklist-to-proceed-to-the-next-step">Checklist to proceed to the next step</a></li>
</ul>


      </nav>

      <div class="body__contained body__section-nav">
        <!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<h1 id="verify-the-release-branch">Verify the release branch</h1>

<hr />

<p>After the release branch is cut you need to make sure it builds and has no significant issues that would block the
creation of the release candidate.</p>

<h2 id="run-verify_release_buildsh">Run <code class="highlighter-rouge">verify_release_build.sh</code></h2>
<ul>
  <li>
    <p>Script: <a href="https://github.com/apache/beam/blob/master/release/src/main/scripts/verify_release_build.sh">verify_release_build.sh</a></p>
  </li>
  <li>
    <p>Usage</p>

    <div class="language-sh highlighter-rouge"><pre class="highlight"><code>./beam/release/src/main/scripts/verify_release_build.sh
</code></pre>
    </div>
  </li>
  <li>
    <p>The script does the following:</p>
    <ol>
      <li>Installs <code class="highlighter-rouge">pip</code>, <code class="highlighter-rouge">virtualenv</code>, <code class="highlighter-rouge">cython</code> and <code class="highlighter-rouge">/usr/bin/time</code> with your agreements;</li>
      <li>Runs <code class="highlighter-rouge">gradle release build</code> against release branch;</li>
    </ol>
  </li>
</ul>

<p>Basically it does <code class="highlighter-rouge">./gradlew build -PisRelease</code> from the root of Beam repository.
This only verifies that everything builds with unit tests passing.</p>

<p>To speed things up locally you might want to omit <code class="highlighter-rouge">--no-parallel</code>.
You might want to omit <code class="highlighter-rouge">--continue</code> if you want the script to fail after the first error instead of continuing,
it may be easier and faster to find environment issues this way without having to wait until the full build completes.</p>

<p>There are some projects that don’t produce the artifacts, e.g. <code class="highlighter-rouge">beam-test-tools</code>`, you may be able to
ignore failures there.</p>

<p>To triage the failures and narrow things down you may want to look at <code class="highlighter-rouge">settings.gradle</code> and run the build only for the
projects you’re interested at the moment, e.g. <code class="highlighter-rouge">./gradlew :runners:java-fn-execution</code>.</p>

<h3 id="verify-the-build-succeeds">Verify the build succeeds</h3>

<p>Tasks you need to do manually:</p>
<ol>
  <li>Check the build result;</li>
  <li>If build failed, scan log will contain all failures;</li>
  <li>You should stabilize the release branch until release build succeeded;</li>
  <li>The script will output a set of Jenkins phrases to enter in the created PR;</li>
</ol>

<hr />

<h2 id="alternative-run-all-commands-manually">(Alternative) Run all commands manually</h2>

<p>Follow the scripts and run all the steps manually, overall you need to do:</p>

<ul>
  <li>
    <p>Install python dependencies, e.g. <code class="highlighter-rouge">pip</code>, <code class="highlighter-rouge">virtualenv</code>, <code class="highlighter-rouge">cython</code>;</p>
  </li>
  <li>
    <p>Run gradle release build, along these lines (check the script):</p>

    <ol>
      <li>
        <p>Unlock the secret key, e.g.:</p>

        <div class="language-sh highlighter-rouge"><pre class="highlight"><code>gpg --output ~/doc.sig --sign ~/.bashrc
</code></pre>
        </div>
      </li>
      <li>
        <p>Run build command, e.g.:</p>

        <div class="language-sh highlighter-rouge"><pre class="highlight"><code>./gradlew build -PisRelease
</code></pre>
        </div>
      </li>
    </ol>
  </li>
</ul>

<hr />

<h2 id="create-release-blocking-issues-in-jira">Create release-blocking issues in JIRA</h2>

<p>The <code class="highlighter-rouge">verify_release_build.sh</code> script may include failing or flaky tests. For each of the failing tests create a JIRA with the following properties:</p>

<ul>
  <li>
    <p>Issue Type: Bug</p>
  </li>
  <li>
    <p>Summary: Name of failing gradle task and name of failing test (where applicable) in form of <em>:MyGradleProject:SomeGradleTask NameOfFailedTest: Short description of failure</em></p>
  </li>
  <li>
    <p>Priority: Major</p>
  </li>
  <li>
    <p>Component: “test-failures”</p>
  </li>
  <li>
    <p>Fix Version: Release number of verified release branch</p>
  </li>
  <li>
    <p>Description: Description of failure</p>
  </li>
</ul>

<hr />

<h2 id="checklist-to-proceed-to-the-next-step">Checklist to proceed to the next step</h2>

<ul>
  <li>Release Manager’s GPG key is published to <code class="highlighter-rouge">dist.apache.org</code>;</li>
  <li>Release Manager’s GPG key is configured in <code class="highlighter-rouge">git</code> configuration;</li>
  <li>Release Manager has <code class="highlighter-rouge">org.apache.beam</code> listed under <code class="highlighter-rouge">Staging Profiles</code> in Nexus;</li>
  <li>Release Manager’s Nexus User Token is configured in <code class="highlighter-rouge">settings.xml</code>;</li>
  <li>JIRA release item for the subsequent release has been created;</li>
  <li>All test failures from branch verification have associated JIRA issues;</li>
  <li>There are no release blocking JIRA issues;</li>
  <li>Release Notes in JIRA have been audited and adjusted;</li>
  <li>Combined javadoc has the appropriate contents;</li>
  <li>Release branch has been created;</li>
  <li>There are no open pull requests to release branch;</li>
  <li>Originating branch has the version information updated to the new version;</li>
  <li>Nightly snapshot is in progress (do revisit it continually);</li>
</ul>

<hr />

<p><a class="button button--primary" href="/contribute/release-guide/build-candidate/">Next Step: Build the Release Candidate</a></p>

      </div>
    </div>
    <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<footer class="footer">
  <div class="footer__contained">
    <div class="footer__cols">
      <div class="footer__cols__col">
        <div class="footer__cols__col__logo">
          <img src="/images/beam_logo_circle.svg" class="footer__logo" alt="Beam logo">
        </div>
        <div class="footer__cols__col__logo">
          <img src="/images/apache_logo_circle.svg" class="footer__logo" alt="Apache logo">
        </div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Start</div>
        <div class="footer__cols__col__link"><a href="/get-started/beam-overview/">Overview</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-java/">Quickstart (Java)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-py/">Quickstart (Python)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-go/">Quickstart (Go)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/downloads/">Downloads</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Docs</div>
        <div class="footer__cols__col__link"><a href="/documentation/programming-guide/">Concepts</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/pipelines/design-your-pipeline/">Pipelines</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/runners/capability-matrix/">Runners</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Community</div>
        <div class="footer__cols__col__link"><a href="/contribute/">Contribute</a></div>
        <div class="footer__cols__col__link"><a href="https://projects.apache.org/committee.html?beam" target="_blank">Team<img src="/images/external-link-icon.png"
                                                                                                                                width="14" height="14"
                                                                                                                                alt="External link."></a></div>
        <div class="footer__cols__col__link"><a href="/contribute/presentation-materials/">Media</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Resources</div>
        <div class="footer__cols__col__link"><a href="/blog/">Blog</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/support/">Support</a></div>
        <div class="footer__cols__col__link"><a href="https://github.com/apache/beam">GitHub</a></div>
      </div>
    </div>
  </div>
  <div class="footer__bottom">
    &copy;
    <a href="http://www.apache.org">The Apache Software Foundation</a>
    | <a href="/privacy_policy">Privacy Policy</a>
    | <a href="/feed.xml">RSS Feed</a>
    <br><br>
    Apache Beam, Apache, Beam, the Beam logo, and the Apache feather logo are
    either registered trademarks or trademarks of The Apache Software
    Foundation. All other products or name brands are trademarks of their
    respective holders, including The Apache Software Foundation.
  </div>
</footer>

  </body>
</html>
